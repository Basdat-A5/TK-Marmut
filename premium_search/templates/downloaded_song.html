{% extends 'base_biasa.html' %}

{% block meta %}
    <title>Downloaded Songs</title>
{% endblock meta %}

{% block content %}
<body class="h-screen flex justify-center bg-[#151829] text-white">

    <div class="py-10 bg-[#151829]">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl font-bold mb-5 text-white font-serif">Daftar Lagu</h2>
            <div class="-mx-4">
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-[#151829] rounded-lg overflow-hidden">
                        <thead class="bg-[#9e60d1] text-white">
                            <tr>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Judul Lagu</th>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Oleh</th>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-400 bg-[#382e47]">
                            {% for song in songs %}
                            <tr class="text-white" data-id="{{ song.id_song }}">
                                <td class="py-3 px-4">{{ song.judul }}</td>
                                <td class="py-3 px-4">{{ song.nama_artist }}</td>
                                <td class="actions">
                                    <a href="{% url 'playlist_player:play_song' %}" style="background-color: #9E60D1; border: none; border-radius: 5px; padding: 8px 12px; color: white; text-decoration: none;">Lihat</a>
                                    <button class="btn-delete" data-id="{{ song.id_song }}" style="background-color: #B17BC9; border: none; border-radius: 5px; padding: 8px 12px; color: white; text-decoration: none; margin-left: 5px;">Hapus</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <p style="text-align: left; margin-top: 20px;"><a href="#" style="background-color: #9E60D1; border: none; border-radius: 5px; padding: 8px 12px; color: white; text-decoration: none;">Kembali</a></p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-[#151829] text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this song?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var songIdToDelete;
            document.querySelectorAll(".btn-delete").forEach(function(button) {
                button.addEventListener("click", function() {
                    songIdToDelete = this.getAttribute("data-id");
                    var deleteModal = new bootstrap.Modal(document.getElementById("deleteModal"));
                    deleteModal.show();
                });
            });

            document.getElementById("confirmDeleteBtn").addEventListener("click", function() {
                fetch("{% url 'premium_search:delete' id_song='0' %}".replace("0", songIdToDelete), {
                    method: "DELETE",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                        "Content-Type": "application/json"
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === "Song deleted successfully") {
                        document.querySelector(`tr[data-id="${data.id_song}"]`).remove();
                    }
                    var deleteModal = bootstrap.Modal.getInstance(document.getElementById("deleteModal"));
                    deleteModal.hide();
                });
            });
        });
    </script>
</body>
{% endblock content %}
